<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>E-shop T3H</title>
    <link rel="stylesheet" href=" 	https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body>
<h1>Cart Info</h1>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
<table class="table table-active table-success table-striped text-align-center container" border="1px"
       style="text-align: center;margin-top: 30px" id="cartTable">
    <tr>
        <th> Product Name</th>
        <th>Qty</th>
        <th>Selling Price</th>
    </tr>
    <tr th:each="cart : ${cart}" th:id="|cart-item-${cart.cart_id}|">
        <td th:text="${cart.title}"></td>
        <td th:text="${cart.qty}"></td>
        <td th:text="${cart.selling_price}"></td>
        <td>
            <button class="btn btn-danger" th:onclick="deleteItem([[${cart.cart_id}]])">Delete</button>
        </td>
    </tr>
    <tr id="totalRow">
        <td>Total</td>
        <td id="totalQty"></td>
        <td id="totalPrice"></td>
        <td><a class="btn btn-success" href="/checkout">Check Out</a></td>
    </tr>
</table>
<script th:inline="javascript">
    /*<![CDATA[*/
    // JavaScript to calculate and display totals
    window.onload = function () {
        calculateTotals();
    };

    function calculateTotals() {
        var totalQty = 0;
        var totalPrice = 0;
        var table = document.getElementById("cartTable");
        for (var i = 1; i < table.rows.length - 1; i++) {
            var row = table.rows[i];
            var qty = parseFloat(row.cells[1].innerText); // Quantity
            var price = parseFloat(row.cells[2].innerText); // Selling Price
            totalQty += qty;
            totalPrice += qty * price;
        }
        document.getElementById("totalQty").innerText = totalQty;
        document.getElementById("totalPrice").innerText = totalPrice.toFixed(2);
    }

    /*]]>*/
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        $(".btn-danger").click(function () {
            var cartId = $(this).data("cart-id");

        });

    });

    function deleteItem(cart_id) {
        console.log(cart_id)
        $.ajax({
            url: "/delete?cart_id=" + cart_id,
            type: "GET",
            success: function (response) {
                $("#cart-item-" + cart_id).remove();
            },
            error: function (xhr, status, error) {
                console.error(xhr.responseText);
            }
        });
    }
</script>
